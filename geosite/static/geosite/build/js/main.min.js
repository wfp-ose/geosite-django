var geosite={};geosite.assert_float=function(e,t){return void 0===e||""===e?t:angular.isNumber(e)?e:parseFloat(e)},geosite.assert_array_length=function(e,t,a){return void 0===e||""===e?a:angular.isString(e)?(e=e.split(","),e.length==t?e:a):angular.isArray(e)?e.length==t?e:a:void 0},geosite.intend=function(e,t,a){a.$emit(e,t)},geosite.init_intents=function(e,t){e.on("click",".geosite-intent",function(e){e.preventDefault();var a=$(this);if(a.hasClass("geosite-toggle"))a.hasClass("geosite-off")?(a.removeClass("geosite-off"),geosite.intend(a.data("intent-names")[0],a.data("intent-data"),t)):(a.addClass("geosite-off"),geosite.intend(a.data("intent-names")[1],a.data("intent-data"),t));else if(a.hasClass("geosite-radio")){var n=a.parents(".geosite-radio-group:first").find(".geosite-radio").not(a);a.hasClass("geosite-on")||(a.addClass("geosite-on"),a.data("intent-class-on")&&(a.addClass(a.data("intent-class-on")),n.removeClass(a.data("intent-class-on"))),n.removeClass("geosite-on"),a.data("intent-class-off")&&(a.removeClass(a.data("intent-class-off")),n.addClass(a.data("intent-class-off"))),geosite.intend(a.data("intent-name"),a.data("intent-data"),t))}else geosite.intend(a.data("intent-name"),a.data("intent-data"),t)})},geosite.controller_base=function(e,t){this.intend=geosite.intend,geosite.init_intents($(t),e)},geosite.init_controller_base=function(e){e.controller("GeositeControllerBase",geosite.controller_base)},geosite.init_controller=function(e,t,a){var n=e.data("controllerName");e.data("controllerType");t.controller(n,a||geosite.controller_base)},geosite.init_controllers=function(e,t,a){for(var n=0;n<a.length;n++){var i=a[n];$(i.selector,e).each(function(){try{geosite.init_controller($(this),t,i.controller)}catch(e){console.log('Could not load Geosite Controller "'+i.selector+'"',e)}})}},geosite.init_state=function(e,t){var a=$.extend({},e),n=getHashValueAsFloat(["latitude","lat","y"])||e.lat||0,i=getHashValueAsFloat(["longitude","lon","long","lng","x"])||e.lon||0,l=getHashValueAsInteger(["zoom","z"])||e.z||3;return a.view=$.extend(a.view,{lat:n,lon:i,z:l}),$.each(a.filters,function(e,n){$.each(n,function(n,i){var l=t.filters[e][n].toLowerCase(),s=getHashValue(e+":"+n,l);void 0!=s&&""!=s&&(a.filters[e][n]=s)})}),a},geosite.ui_init_slider_label=function(e,t,a,n){if("ordinal"==t){var i=e.data("label-template").replace(new RegExp("{{(\\s*)value(\\s*)}}","gi"),n);e.data("label").html(i)}else if("continuous"==t)if("true"==a.toLowerCase()){var i=e.data("label-template").replace(new RegExp("{{(\\s*)value(s?).0(\\s*)}}","gi"),n[0]).replace(new RegExp("{{(\\s*)value(s?).1(\\s*)}}","gi"),n[1]);e.data("label").html(i)}else if("min"==a||"max"==a){var i=e.data("label-template").replace(new RegExp("{{(\\s*)value(\\s*)}}","gi"),n);e.data("label").html(i)}},geosite.ui_init_slider_slider=function(e,t,a,n,i,l,s,o){"ordinal"==a?t.slider({range:"true"==n.toLowerCase()?!0:n,value:i,min:0,max:s,step:1,slide:function(a,n){geosite.ui_update_slider_label.apply(this,[a,n]);var i=t.data("output"),l=t.data("options")[n.value],s={};s[i]=l,geosite.intend("filterChanged",{layer:"popatrisk",filter:s},e)}}):"continuous"==a&&("true"==n.toLowerCase()?t.slider({range:!0,values:i,min:l,max:s,step:o,slide:function(a,n){geosite.ui_update_slider_label.apply(this,[a,n]);var i=t.data("output"),l=n.values,s={};s[i]=l,geosite.intend("filterChanged",{layer:"popatrisk",filter:s},e)}}):("min"==n||"max"==n)&&t.slider({range:n,value:i,min:l,max:s,step:o,slide:function(a,n){geosite.ui_update_slider_label.apply(this,[a,n]);var i=t.data("output"),l=n.value/100,s={};s[i]=l,geosite.intend("filterChanged",{layer:"popatrisk",filter:s},e)}}))},geosite.ui_update_slider_label=function(e,t){var a=$(this),n=a.data("type"),i=a.data("range");if("ordinal"==n){var l=a.data("options")[t.value],s=a.data("label-template").replace(new RegExp("{{(\\s*)value(\\s*)}}","gi"),l);a.data("label").html(s)}else if("continuous"==n)if("true"==i.toLowerCase()){var s=a.data("label-template").replace(new RegExp("{{(\\s*)value(s?).0(\\s*)}}","gi"),t.values[0]).replace(new RegExp("{{(\\s*)value(s?).1(\\s*)}}","gi"),t.values[1]);a.data("label").html(s)}else if("min"==i||"max"==i){var s=a.data("label-template").replace(new RegExp("{{(\\s*)value(\\s*)}}","gi"),t.value/100);a.data("label").html(s)}};var getHashValue=function(e,t){var a=void 0;e="string"==typeof e?[e.toLowerCase()]:$.map(e,function(e,t){return e.toLowerCase()});for(var n=location.hash.toLowerCase(),i=0;i<e.length;i++){var l=e[i],s=n.match(new RegExp(l+"=([^&]*)"));if(s&&(a=s[1],void 0!=a&&null!=a&&""!=a))break}if(void 0!=t)if("integer"==t)a=void 0!=a&&null!=a&&""!=a?parseInt(a,10):void 0;else if("integerarray"==t){if(void 0!=a){for(var o=a.split(","),r=[],i=0;i<o.length;i++){var u=o[i];r.push(void 0!=u&&null!=u&&""!=u?parseInt(u,10):void 0)}a=r}}else if("float"==t)a=void 0!=a&&null!=a&&""!=a?parseFloat(a):void 0;else if("floatarray"==t&&void 0!=a){for(var o=a.split(","),r=[],i=0;i<o.length;i++){var u=o[i];r.push(void 0!=u&&null!=u&&""!=u?parseFloat(u):void 0)}a=r}return a},hasHashValue=function(e){var t=getHashValue(e);return void 0!=t&&null!=t&&""!=t},getHashValueAsInteger=function(e){return getHashValue(e,"integer")},getHashValueAsIntegerArray=function(e){return getHashValue(e,"integerarray")},getHashValueAsFloat=function(e){return getHashValue(e,"float")},sortLayers=function(e,t){var a=$.isArray(e)?e:$.map(e,function(e){return e});return a=a.sort(function(e,t){return e.options.renderOrder-t.options.renderOrder}),t===!0&&a.reverse(),a},updateRenderOrder=function(e){for(var t=0;t<e.length;t++)e[t].bringToFront()},layersAsArray=function(e){return $.map(e,function(e,t){return{id:t,layer:e}})};